# Summary
|        | Issue | Instances | Gas Saved |
|--------|-------|-----------|-----------|
|[G-01]|Compiling with another version|-|-415800|
|[G-02]|Change the number of runs|-|-12369516|
|[G-03]|Review of automated finding G-05 and G-09|-|-|


The gas saved column simply adds up the evolution in the snapshot, using the method described in the next section.
# Benchmark
A benchmark is performed on each optimization, using the tests snapshot provided by foundry. This snapshot is based on tests and therefore does not take into account all functions, this loss is accepted. But it is also subject to intrinsic variance. This means that some tests are not relevant to the comparison because they vary too much and are thus not taken into account. These are listed below:
>testUnderlyingIsSet()
>testConstructor()

# [G-01] Compiling with another version
A recent version of the compiler achieves better results with the optimizer, most of the time. But it is not always the case, and as this mostly works like a black box, it is hard to predict it. Thus, versions must be tested. 
The results are presented below:

||0.8.15|0.8.16|0.8.17|0.8.18|0.8.19|0.8.20|
|-|-|-|-|-|-|-|
|Gas diff:|-1930|-130844|-420577|-420587|-420697|-420697|

The gas diff is the sum of the tests snapshot.

Barring any special security constraints, it would be worthwhile changing versions. `0.8.19` is suggested, as it is both better known and more efficient. Further increases are pointless.

Applying this optimisation, those changes appear in the snapshot:
```
testCallModifyLiability(address) (gas: -1 (-0.000%))
testCallVaultControllerTransfer(address) (gas: 4 (0.002%))
testRevertIfVaultInsolvent(address) (gas: 4 (0.003%))
testRevertIfVaultInsolvent() (gas: 4 (0.003%))
testLiquidateWithCurveLpAsCollateral() (gas: -14 (-0.003%))
testCheckVaultInsolvent() (gas: 8 (0.003%))
testVaultSummaries() (gas: 6 (0.005%))
testRevertIfTokenAlreadyRegistered(address,uint64,uint256) (gas: 13 (0.006%))
testBorrowUSDACallsCurrentValue() (gas: 15 (0.006%))
testLiquidateWhenLiquidationFeeIsZero() (gas: -32 (-0.006%))
testTokensToLiquidate() (gas: 8 (0.007%))
testRevertIfVaultIsSolvent(uint256) (gas: 8 (0.008%))
testRevertIfVaultIsSolvent(uint256) (gas: 8 (0.008%))
testRevertIfVaultIsSolvent() (gas: 8 (0.008%))
testRevertIfVaultIsSolvent() (gas: 8 (0.008%))
testCheckVaultSolvent() (gas: 8 (0.008%))
testCap(uint256) (gas: -10 (-0.011%))
testBorrowUSDAWithFeeInZero() (gas: 26 (0.011%))
testAmountToSolvency() (gas: -15 (-0.013%))
testSimulateLiquidateVault() (gas: 64 (0.013%))
testEmitEvent(address) (gas: 32 (0.014%))
testCheckVaultCallsCurrentValue() (gas: -17 (-0.016%))
testWithdrawToRevertsIfAmountIsGreaterThanBalance() (gas: 5 (0.017%))
testWithdrawRevertsIfAmountIsGreaterThanBalance() (gas: 5 (0.018%))
testWithdrawToCallsTransferOnToken(uint256) (gas: 11 (0.018%))
testUpdateRegisteredERC20(address,uint256,uint256) (gas: 8 (0.019%))
testVaultSummariesBigEnd() (gas: 40 (0.019%))
testVaultSummariesAll() (gas: 40 (0.019%))
testWithdrawCallsTransferOnToken(uint256) (gas: 11 (0.019%))
testBorrowUSDATo() (gas: 48 (0.019%))
testBorrowUSDA() (gas: 48 (0.019%))
testBorrowUSDATreasuryReceivesFee() (gas: 48 (0.020%))
testLiquidateWbtc() (gas: 71 (0.020%))
testEnabledTokens() (gas: 8 (0.021%))
testRevertCapReached(uint256) (gas: -15 (-0.021%))
testWithdrawAllToCallsTransferOnToken() (gas: 11 (0.022%))
testRevertIfWbtcVaultIsSolvent(uint256) (gas: 57 (0.022%))
testVaultBorrowingPower() (gas: 22 (0.022%))
testCallModifyLiability(uint56) (gas: 15 (0.022%))
testCallVaultControllerBurn(uint56) (gas: 15 (0.022%))
testEmitEvent(uint256) (gas: -16 (-0.022%))
testWithdrawToCallsPayInterest() (gas: 11 (0.022%))
testWithdrawCallsTransferOnToken() (gas: 11 (0.023%))
testWithdrawAllToCallsPayInterest() (gas: 11 (0.023%))
testWithdrawCallsPayInterest() (gas: 11 (0.023%))
testWithdrawCallsPayInterest() (gas: 11 (0.024%))
testEmitEvent(uint256) (gas: -16 (-0.024%))
testVaultBorrowingPowerWbtc() (gas: 26 (0.025%))
testTotalUnderlying() (gas: 4 (0.025%))
testMintAddsToUserBalance(uint256) (gas: -18 (-0.026%))
testMintAddsToTotalSupply(uint256) (gas: -18 (-0.026%))
testMintAddsToUserBalance(uint256) (gas: -18 (-0.028%))
testMintAddsToTotalSupply(uint256) (gas: -18 (-0.028%))
testWithdrawAllToWhenAmountIsMoreThanReserve() (gas: 19 (0.028%))
testLiquidatePartialWbtc() (gas: 119 (0.029%))
testValidVault() (gas: 10 (0.029%))
testVaultControllerDonate(uint56) (gas: 10 (0.029%))
testWithdrawAllWhenAmountIsMoreThanReserve() (gas: 19 (0.029%))
testGetCollateralsInfoWith2Items() (gas: 32 (0.033%))
testUpdateRegisteredSingleToCurveLPStakedOnConvex(address,uint256,uint256,uint256) (gas: -32 (-0.033%))
testGetCollateralsInfoWith5Items() (gas: 45 (0.035%))
testWrapperToUnderlying(uint256) (gas: 6 (0.036%))
testUnderlyingToWrapper(uint256) (gas: 6 (0.036%))
testVaultBorrowingPowerWhenOracleReturnsZero() (gas: -37 (-0.037%))
testIncrease(uint56) (gas: 15 (0.038%))
testCallModifyLiability() (gas: 24 (0.038%))
testCallVaultControllerBurn() (gas: 24 (0.038%))
testCallExternalCalls() (gas: 166 (0.039%))
testDepositERC20(uint256) (gas: -20 (-0.040%))
testBurnSubtractsFromUserBalance(uint256) (gas: -15 (-0.042%))
testBurnSubtractsFromTotalSupply(uint256) (gas: -15 (-0.042%))
testRegisterERC20(address,address,uint8) (gas: -104 (-0.044%))
testVaultControllerDonateMoreThanMaxSupplyCapsMaxSupply() (gas: 37 (0.048%))
testVaultBorrowingPowerMultipleCollateral() (gas: -193 (-0.049%))
testRevertIfIncompatibleLTV(address,uint64,uint256) (gas: 8 (0.049%))
testBurnSubtractsFromUserBalance(uint256) (gas: -15 (-0.049%))
testBurnSubtractsFromTotalSupply(uint256) (gas: -15 (-0.049%))
testSubstractFromReserveAmount(uint56) (gas: 40 (0.053%))
testRegisterCurveLPToken(address,uint64,uint256,uint8) (gas: -155 (-0.053%))
testEmitEvent(uint256) (gas: -21 (-0.055%))
testWithdrawERC20() (gas: -17 (-0.055%))
testVaultBorrowingPowerWhenLTVIsZero() (gas: -183 (-0.055%))
testModifyLiabilitIncrease(uint56) (gas: 10 (0.056%))
testRepayUSDA(uint56) (gas: 40 (0.057%))
testEmitEvent(uint256) (gas: 36 (0.061%))
testEmitEvent(uint256) (gas: -21 (-0.063%))
testEmitEvent() (gas: 262 (0.063%))
testEmitEvent(uint256) (gas: 36 (0.064%))
testDecrease(uint56) (gas: 26 (0.064%))
testModifyLiabilitDecrease() (gas: 8 (0.067%))
testRevertIfReserveIsEmpty() (gas: 36 (0.072%))
testEmitEvent() (gas: -21 (-0.073%))
testWithdrawToSubstractsFromUserBalance(uint256) (gas: 44 (0.074%))
testWithdrawToSubstractsFromTotalSupply(uint256) (gas: 44 (0.075%))
testWithdrawToSubstractsFromReserveAmount(uint256) (gas: 44 (0.075%))
testEmitEvent(uint256,uint128) (gas: -54 (-0.076%))
testRevertIfReserveIsEmpty() (gas: 36 (0.076%))
testWithdrawSubstractsFromUserBalance(uint256) (gas: 44 (0.077%))
testControllerTransfer(address) (gas: -17 (-0.078%))
testWithdrawSubstractsFromTotalSupply(uint256) (gas: 44 (0.078%))
testWithdrawSubstractsFromReserveAmount(uint256) (gas: 44 (0.078%))
testEmitEvent(uint256,uint128) (gas: -54 (-0.079%))
testDepositAddsToUserBalance(uint256,uint128) (gas: -54 (-0.079%))
testDepositAddsToTotalSupply(uint256,uint128) (gas: -54 (-0.079%))
testDepositAddsToUserBalance(uint256,uint128) (gas: -54 (-0.082%))
testEmitEvent() (gas: -21 (-0.082%))
testGetLiquidationFee(uint192) (gas: 17 (0.082%))
testDepositAddsToTotalSupply(uint256,uint128) (gas: -54 (-0.082%))
testBalanceOfUnderlying(address,uint256) (gas: -60 (-0.085%))
testEmitEvent() (gas: -21 (-0.090%))
testModifyTotalDepositedIsCalled(uint256) (gas: -45 (-0.090%))
testEmitEvent() (gas: -21 (-0.090%))
testWithdrawAllToSubstractsFromUserBalance() (gas: 44 (0.092%))
testWithdrawAllToSubstractsFromReserveAmount() (gas: 44 (0.093%))
testWithdrawAllToSubstractsFromTotalSupply() (gas: 44 (0.093%))
testWithdrawSubstractsFromUserBalance() (gas: 44 (0.096%))
testWithdrawAllToReturnsCorrectAmount() (gas: 44 (0.098%))
testWithdrawSubstractsFromReserveAmount() (gas: 44 (0.098%))
testWithdrawSubstractsFromTotalSupply() (gas: 44 (0.098%))
testGetBorrowingFee(uint192) (gas: 17 (0.101%))
testRevertIfProvidedTokenIsNotCurveLP() (gas: -40 (-0.102%))
testWithdrawAllReturnsCorrectAmount() (gas: 44 (0.103%))
testRevertIfTokenNotRegistered(address) (gas: -40 (-0.106%))
testBurnSubtractsFromUserBalance() (gas: -23 (-0.108%))
testBurnSubtractsFromTotalSupply() (gas: -23 (-0.110%))
testBurnSubtractsFromUserBalance() (gas: -18 (-0.111%))
testRevertIfOverWithdrawal(uint256) (gas: -32 (-0.117%))
testBurnSubtractsFromTotalSupply() (gas: -19 (-0.119%))
testDepositCallsTransferFromOnUser(uint256,uint128) (gas: -84 (-0.123%))
testRevertIfUpdatingPoolIdAndLpTokenDoesNotMatch(address,uint256,uint256,uint256) (gas: -32 (-0.125%))
testDepositCallsTransferFromOnUser(uint256,uint128) (gas: -84 (-0.127%))
testMintCallsTransferFromOnUser(uint256,uint128) (gas: -84 (-0.128%))
testToBase18() (gas: -14 (-0.132%))
testWithdrawToSubstractsFromUserBalance(uint256,uint128) (gas: -53 (-0.137%))
testWithdrawToSubstractsFromTotalSupply(uint256,uint128) (gas: -53 (-0.138%))
testModifyTotalDepositedIsCalled() (gas: -42 (-0.140%))
testMintCallsTransferFromOnUser(uint256,uint128) (gas: -100 (-0.141%))
testWithdrawERC20CallsCheckVault() (gas: -42 (-0.141%))
testEmitEvent(uint256,uint128) (gas: -59 (-0.143%))
testWithdrawSubstractsFromUserBalance(uint256,uint128) (gas: -53 (-0.146%))
testExpectTransferCRV() (gas: -64 (-0.146%))
testWithdrawSubstractsFromTotalSupply(uint256,uint128) (gas: -53 (-0.146%))
testEmitEvent(uint256,uint128) (gas: -59 (-0.151%))
testWithdrawAllToCallsTransferFromUser() (gas: -54 (-0.170%))
testRevertsIfCalledByNonVault() (gas: -25 (-0.174%))
testWithdrawAllCallsTransferFromUser() (gas: -54 (-0.184%))
testVaultLiability(uint56) (gas: -38 (-0.201%))
testRevertsIfCalledByNonVault(uint56) (gas: -25 (-0.205%))
testTokenBalance(uint256) (gas: -103 (-0.205%))
testRevertIfTokenNotRegistered(address,uint256) (gas: -40 (-0.230%))
testRevertIfTokenNotRegistered(address,uint256) (gas: -40 (-0.230%))
testWithdrawToCallsTransferFromUser(uint256,uint128) (gas: -89 (-0.231%))
testCanStakeReturnFalseWithZeroBalance(address) (gas: -40 (-0.232%))
testMigrateCollaterallsFrom() (gas: -13018 (-0.237%))
testMigrateFromPreviousVaultController() (gas: -13018 (-0.237%))
testWithdrawAllToSubstractsFromUserBalance(uint128) (gas: -69 (-0.241%))
testWithdrawAllToSubstractsFromTotalSupply(uint128) (gas: -69 (-0.242%))
testWithdrawCallsTransferFromUser(uint256,uint128) (gas: -89 (-0.246%))
testRevertIfWrongCollateral() (gas: -13037 (-0.258%))
testDeployedCorrectly() (gas: -13036 (-0.258%))
testWithdrawAllSubstractsFromUserBalance(uint128) (gas: -69 (-0.261%))
testWithdrawAllSubstractsFromTotalSupply(uint128) (gas: -69 (-0.263%))
testBurnCallsTransferToUser(uint256,uint128) (gas: -89 (-0.266%))
testBurnCallsTransferToUser(uint256,uint128) (gas: -105 (-0.271%))
testRevertIfProvidedTokenIsNotCurveLP() (gas: -43 (-0.284%))
testCurrentValueRevertWithInvalidOracleValue() (gas: -40 (-0.284%))
testCurrentValueRevertWithAnchorTooHighAndStalePrice(uint256) (gas: -99 (-0.304%))
testRevertControllerWithdrawAndUnwrap(address,uint256) (gas: -40 (-0.305%))
testCurrentValueRevertWithAnchorTooHigh(uint256) (gas: -99 (-0.305%))
testBurnCallsTransferToUser(uint128) (gas: -89 (-0.308%))
testCurrentValueRevertWithAnchorTooLow(uint256) (gas: -102 (-0.314%))
testCurrentValueRevertWithAnchorTooLowAndStalePrice(uint256) (gas: -102 (-0.314%))
testGetVault() (gas: -9839 (-0.320%))
testUnPauseVaultController() (gas: -9839 (-0.321%))
testMintVault() (gas: -9839 (-0.323%))
testRecoverDust(address,uint256) (gas: -68 (-0.325%))
testRevertIfTokenNotRegistered(address) (gas: -43 (-0.326%))
testDeployVault(uint96,address) (gas: -9831 (-0.330%))
testExpectCallDepositOnConvex(uint256) (gas: -255 (-0.337%))
testCTokenOracleCurrentValue(uint256,uint256) (gas: -93 (-0.369%))
testPeekValue(uint32,uint32) (gas: -183 (-0.389%))
testRevertIfIncompatibleLTV(address,address,uint64,uint256) (gas: -106 (-0.395%))
testRevertIfBalanceZero(address) (gas: -83 (-0.398%))
testClaimableRewards() (gas: -209 (-0.414%))
testCurrentValueRevertWithInvalidAnchorValue() (gas: -83 (-0.419%))
testClaimableWhenAmphClaimerIsZeroAddress() (gas: -171 (-0.428%))
testRevertIfStakeOnConvexFails(uint256) (gas: -232 (-0.440%))
testRevertIfPoolIdZero(address) (gas: -83 (-0.444%))
testBurnCallsTransferToUser(uint128) (gas: -105 (-0.444%))
testClaimExtraRewards() (gas: -264 (-0.454%))
testCurrentValue(uint32,uint32) (gas: -222 (-0.485%))
testControllerWithdrawAndUnwrap(address,uint256) (gas: -68 (-0.496%))
testClaimWhenNoAMPHToClaim() (gas: -280 (-0.501%))
testRevertIfRegisterCurveLpWithMoreThan18Decimals(address,uint64,uint256,uint8) (gas: -165 (-0.562%))
testRevertIfRegisterERC20WithMoreThan18Decimals(address,address,uint8) (gas: -114 (-0.572%))
testPeekValue(uint256,uint256) (gas: -95 (-0.583%))
testDepositTokenAlreadyStaked(uint256) (gas: -574 (-0.610%))
testRevertIfTokenIsStaked(address) (gas: -533 (-0.613%))
testRevertIfStakeOnConvexOnAlreadyStakedTokenFails(uint256) (gas: -553 (-0.616%))
testRevertIfStakeFails(address) (gas: -533 (-0.641%))
testCanStakeReturnTrue(address) (gas: -361 (-0.642%))
testClaimWhenTheRewardsAreZero() (gas: -212 (-0.643%))
testStakeCurveLP(address) (gas: -561 (-0.644%))
testRevertIfRegisterFromNonOwner(address,address,uint256,uint256,uint256,uint8) (gas: -114 (-0.652%))
testCanStakeReturnFalseWhenTokenAlreadyStaked(address) (gas: -576 (-0.655%))
testRevertIfUnstakeOnConvexFails(uint256) (gas: -441 (-0.659%))
testRevertIfTokenAddressDoesNotMatchLPTokenAddress(address,address,uint64,uint256) (gas: -165 (-0.665%))
testCanStakeReturnFalseWithZeroPoolId(address) (gas: -361 (-0.671%))
testClaimMultipleTokens() (gas: -451 (-0.684%))
testCallExternalCalls() (gas: -723 (-0.686%))
testExpectCallWithdrawOnConvex(uint256) (gas: -487 (-0.705%))
testCallsPeekValueOnStEthOracle() (gas: -130 (-0.808%))
testCallsStEthPerTokenOnWsteth() (gas: -130 (-0.809%))
testDeploy(address,address,address,address,uint256,uint256) (gas: -11028 (-0.910%))
testClaimableWithMoreAMPHThanNeeded() (gas: 1131 (1.008%))
testCTokenOracleConstructorWhenUnderlyingIsETH() (gas: -6571 (-1.219%))
testUniswapV3OracleRelayCurrentValueMocked(uint8,uint8,bool,uint256) (gas: -18664 (-1.315%))
testUniswapV3OracleRelayCurrentValueMocked(uint8,uint8,bool) (gas: -18658 (-1.371%))
testCliffsAreConsumed() (gas: 58355 (3.121%))
Overall gas change: -415800 (-0.181%)
```

# [G-02] Change the number of runs
The optimizer must be set to a number of runs (20000 here), meaning how many times the contracts are meant to be used. A huge number of runs improves the running cost, but penalizes the deployment cost, and inversely. It is an important value to optimize. 
The number of runs are compared in the following table.

| |1 runs|100 runs|1000 runs|10000 runs|50000 runs|100000 runs|10000000 runs|
|-|-|-|-|-|-|-|-|
|Gas diff:|-14917428|-16487981|-12369516|-248333|+11183655|+11164312|+11159728|

It's important to note that the number of runs has no impact on compilation time. The final choice will therefore depend on how much the deployer is willing to pay for this part because the deployment cost increase strongly with the number of runs.
Here this seems too large, it would be interesting to reduce it to 1000 for example because some functions, even if used a very small number of times, are extremely expensive.

Applying this optimisation (1000 runs) , those changes appear in the snapshot:

```
testRevertIfProvideOnlyOneAnchor() (gas: -3 (-0.007%))
testEmitEvent() (gas: 33 (0.037%))
testCap() (gas: 162 (0.045%))
testDepositSUSD() (gas: 105 (0.045%))
testDonateSUSD() (gas: 102 (0.047%))
testStakeAndWithdrawCurveLP() (gas: 552 (0.050%))
testStakeCrvLpAfterPoolIdUpdate() (gas: 441 (0.051%))
testEmitEvent(uint56) (gas: 30 (0.052%))
testEmitEvent(uint56) (gas: 45 (0.052%))
testEthSafeCurveLpOracleIsSafeFromManipulation() (gas: 192 (0.052%))
testEthSafeCurveLpOracleIsSafeFromManipulation() (gas: 192 (0.055%))
testClaimCurveLPRewardsWithClaimerAsZeroAddress() (gas: 492 (0.056%))
testRevertWhenDifferentUnderlying() (gas: 74 (0.059%))
testDepositCrvLpAfterPoolIdUpdate() (gas: 525 (0.059%))
testUSDAOwner() (gas: 6 (0.060%))
testRevertCapReached() (gas: 201 (0.060%))
testVaultControllerOwner() (gas: 6 (0.060%))
testVaultDeposits() (gas: 12 (0.061%))
testRecoverDust() (gas: 204 (0.061%))
testAddsToUserBalance(uint56) (gas: 57 (0.064%))
testAddsToUserBalance(uint56) (gas: 57 (0.066%))
testAddsVaultController() (gas: 60 (0.069%))
testTransferSUSDtoUSDA() (gas: 111 (0.072%))
testClaimMultipleCurveLPWithExtraRewards() (gas: 2433 (0.072%))
testSetEmergencyVotingPeriod() (gas: 12 (0.076%))
testSetVotingDelay() (gas: 12 (0.076%))
testSetDelay() (gas: 12 (0.076%))
testSetEmergencyDelay() (gas: 12 (0.076%))
testSetEmergencyQuorumVotes() (gas: 12 (0.076%))
testSetQuorumVotes() (gas: 12 (0.076%))
testSetVotingPeriod() (gas: 12 (0.076%))
testSetOptimisticQuorumVotes() (gas: 12 (0.076%))
testSetProposalThreshold() (gas: 12 (0.076%))
testSetOptimisticDelay() (gas: 12 (0.076%))
testDepositAddsToReserve(uint56) (gas: 69 (0.078%))
testDepositAddsToReserve(uint56) (gas: 69 (0.080%))
testSetMaxWhitelistPeriod() (gas: 12 (0.083%))
testEmitEvent(uint56) (gas: 36 (0.083%))
testRevertIfDepositingMoreThanBalance() (gas: 138 (0.094%))
testRevertIfWithdrawMoreThanBalance() (gas: 252 (0.095%))
testReserveRatioAfterMint(uint64) (gas: 60 (0.098%))
testEmitEvent() (gas: 26 (0.098%))
testEmitEvent() (gas: 24 (0.102%))
testAddsToTotalSupply(uint56) (gas: 93 (0.104%))
testDepositCallsTransferFrom(uint56) (gas: 96 (0.106%))
testDepositCallsPaysInterest(uint56) (gas: 96 (0.107%))
testAddsToTotalSupply(uint56) (gas: 93 (0.107%))
testNoLoans() (gas: 453 (0.107%))
testDepositCallsTransferFrom(uint56) (gas: 96 (0.109%))
testDepositCallsPaysInterest(uint56) (gas: 96 (0.109%))
testRevertsIfProposalNotQueued() (gas: 36 (0.112%))
testAddsToAdminBalance(uint56) (gas: 66 (0.112%))
testClaimCurveLPRewards() (gas: 1179 (0.114%))
testRevertsIfDeposit0Amount() (gas: 24 (0.118%))
testDoesNotCallPayInterestOnRemovedVaultControllers() (gas: 84 (0.121%))
testDoesNotCallPayInterestOnRemovedVaultControllers() (gas: 81 (0.121%))
testCreateProposal() (gas: 630 (0.122%))
testMintVault() (gas: 24 (0.123%))
testRevertsMultipleActiveProposals() (gas: 618 (0.124%))
testRevertsMultiplePendingProposals() (gas: 618 (0.125%))
testWithdrawAllReserve() (gas: 360 (0.125%))
testMintCallsPaysInterest(uint56) (gas: 75 (0.127%))
testMakeOptimisticProposals() (gas: 1758 (0.128%))
testRevertsIfAmountIsZero() (gas: 24 (0.132%))
testRevertsIfAmountIsZero() (gas: 24 (0.132%))
testEmitEvent(uint56) (gas: 99 (0.132%))
testRevertsIfDeposit0Amount() (gas: 24 (0.132%))
testRevertsIfAmountIsZero() (gas: 24 (0.132%))
testAddsToTotalSupply(uint56) (gas: 78 (0.134%))
testEmitEvent(uint256) (gas: 69 (0.137%))
testDepositMultipleCurveLPAndBorrow() (gas: 3339 (0.137%))
testRevertsSetWhitelistAccountExpirationExceedsMax() (gas: 24 (0.138%))
testRevertsIfCalledByNonOwner() (gas: 36 (0.139%))
testRevertsIfCalledByNonOwner() (gas: 36 (0.139%))
testEmitEvent() (gas: 30 (0.141%))
testCallsPayInterestOnAllVaultControllers() (gas: 195 (0.141%))
testSetPauserEmitEvent() (gas: 33 (0.143%))
testRemovesVaultController() (gas: 48 (0.145%))
testClaimCurveLPRewardsOverAndOverShouldTransferAllCVXBalance() (gas: 1698 (0.148%))
testAddsToUserBalance(uint56) (gas: 84 (0.148%))
testSetWhitelistGuardian() (gas: 57 (0.149%))
testInterestGeneration() (gas: 1080 (0.151%))
testSubsToAdminBalance(uint56) (gas: 72 (0.162%))
testRevertIfDepositIsZero() (gas: 129 (0.163%))
testAccountsForUSDARewards() (gas: 1008 (0.165%))
testCallsPaysInterest() (gas: 84 (0.170%))
testAddsToTotalSupply(uint56) (gas: 96 (0.173%))
testRevertIfSupplyOverflows() (gas: -332 (-0.181%))
testBurnCallsPaysInterest(uint56) (gas: 81 (0.182%))
testAddsToReserveAmount(uint256) (gas: 93 (0.189%))
testAddsToTotalSupply(uint256) (gas: 93 (0.189%))
testCallsTransferFromOnToken(uint256) (gas: 96 (0.190%))
testWstEthOracle() (gas: 444 (0.190%))
testSubsToTotalSupply(uint56) (gas: 84 (0.193%))
testRevertVaultDepositETH() (gas: 33 (0.196%))
testRevertsIfCalledByNonOwner() (gas: 36 (0.197%))
testBorrow() (gas: 975 (0.200%))
testReserveRatio() (gas: 30 (0.207%))
testCompletelyRepayVault() (gas: 1350 (0.210%))
testRevertBorrowIfVaultInsolvent() (gas: 915 (0.210%))
testRecoverIfPaused() (gas: 51 (0.211%))
testDecimalsReturnsDecimals() (gas: 12 (0.214%))
testNameReturnsName() (gas: 21 (0.215%))
testSymbolReturnsSymbol() (gas: 21 (0.215%))
testRevertIfBurnAmountExceedsBalance() (gas: 39 (0.220%))
testDepositRevertsIfPaused(uint56) (gas: 57 (0.221%))
testBorrowLessThan18Decimals() (gas: 1317 (0.226%))
testRevertIfDepositETH() (gas: 39 (0.231%))
testSubsToUserBalance(uint56) (gas: 93 (0.232%))
testSetWhitelistAccountExpiration() (gas: 48 (0.232%))
testE2EPeekValueUSDCWETH() (gas: 186 (0.232%))
testRevertsIfProposalNotSucceded() (gas: 63 (0.235%))
testLiabilityAfterAWeek() (gas: 1245 (0.242%))
testSnxOracle() (gas: 441 (0.243%))
testOracleType() (gas: 24 (0.245%))
testOracleType() (gas: 24 (0.245%))
testRevertIfInvalidSupply() (gas: -326 (-0.246%))
testE2EPeekValueSnx() (gas: 444 (0.248%))
testRevertsIfProposalAlreadyQueued() (gas: 936 (0.249%))
testRevertIfInvalidAddress() (gas: -338 (-0.252%))
testAddsToUserBalances(uint256) (gas: 162 (0.253%))
testTriCryptoReturnsTheCorrectPrice() (gas: 1131 (0.261%))
testSubsToTotalSupply(uint56) (gas: 105 (0.268%))
testE2EPeekValueDydxWETH() (gas: 375 (0.269%))
testKeepsRoleVaultController() (gas: 57 (0.270%))
testLiquidateVaultWhenCollateralLosesValue() (gas: 1773 (0.275%))
testCancelProposal() (gas: 339 (0.276%))
testRevertsIfCalledByNonOwner() (gas: 51 (0.278%))
testRevertsIfPaused() (gas: 69 (0.279%))
testRevertsIfCalledByNonOwner() (gas: 51 (0.279%))
testCallsTransferOnToken() (gas: 69 (0.279%))
testRevertsIfCalledByNonOwner() (gas: 51 (0.279%))
testGetMsgData(uint256) (gas: 45 (0.283%))
testRevertsWhenSetMaxWhitelistPeriodNotGovernorCharlie() (gas: 24 (0.284%))
testRevertsWhenSetQuorumVotesNotGovernorCharlie() (gas: 24 (0.284%))
testRevertsWhenSetDelayNotGovernorCharlie() (gas: 24 (0.284%))
testRevertsWhenSetEmergencyQuorumVotesNotGovernorCharlie() (gas: 24 (0.284%))
testRevertsWhenSetEmergencyVotingPeriodNotGovernorCharlie() (gas: 24 (0.285%))
testRevertsWhenSetVotingDelayNotGovernorCharlie() (gas: 24 (0.285%))
testRevertsWhenSetVotingPeriodNotGovernorCharlie() (gas: 24 (0.285%))
testRevertsWhenSetProposalThresholdNotGovernorCharlie() (gas: 24 (0.285%))
testRevertsWhenSetOptimisticQuorumVotesNotGovernorCharlie() (gas: 24 (0.286%))
testRevertsWhenSetOptimisticDelayNotGovernorCharlie() (gas: 24 (0.286%))
testCbEthOracle() (gas: 522 (0.286%))
testRevertsWhenSetEmergencyDelayNotGovernorCharlie() (gas: 24 (0.287%))
testChainlinkOracleRelaySetStaleDelayRevertWithZero() (gas: 30 (0.287%))
testSetNewToken() (gas: 57 (0.288%))
testCanDelegateVotes() (gas: 363 (0.291%))
testCbEthReturnsTheCorrectPrice() (gas: 1365 (0.303%))
testCbEthReturnsTheCorrectPrice() (gas: 1365 (0.303%))
testWithdrawWhileLTVisEnough() (gas: 2205 (0.306%))
testOracleType() (gas: 30 (0.307%))
testCallsPeekValueOnEthFeed() (gas: 132 (0.309%))
testCallsPeekValueOnCbEthFeed() (gas: 132 (0.310%))
testQueueProposal() (gas: 870 (0.316%))
testGetCurrentVotes(address) (gas: 279 (0.316%))
testConstructorValuesSet() (gas: 48 (0.319%))
testLiquidateVaultWhenCollateralLosesValueLessThan18Decimals() (gas: 2625 (0.324%))
testChainlinkOracleRelaySetStaleDelay(uint256) (gas: 54 (0.328%))
testRevertsWhenSetNotTokenNotGovernorCharlie() (gas: 45 (0.329%))
testRevertsWhenSetWhitelistAccountExpirationNotGovernorCharlie() (gas: 45 (0.329%))
testSetCurve() (gas: 69 (0.329%))
testRevertsWhenSetWhitelistGuardianNotGovernorCharlie() (gas: 45 (0.330%))
testRevertsIfProposalAlreadyExecuted() (gas: 885 (0.332%))
testRevertIfBurnByNonAdmin() (gas: 78 (0.334%))
testLiquidateVaultWhenPriceIsStale() (gas: 3840 (0.334%))
testPartialRepay() (gas: 1998 (0.339%))
testRevertIfTotalSupplyTooHigh(address) (gas: 162 (0.341%))
testRevertIfAmountTooHigh(address) (gas: 162 (0.342%))
testBalanceOfUserWithTokens() (gas: 42 (0.349%))
testLiquidateCompleteVault() (gas: 3825 (0.350%))
testReserveRatioDoesntChangeWithBalance(uint64) (gas: 75 (0.360%))
testDelegate(address) (gas: 345 (0.367%))
testExecuteProposalMarksItAsExecuted() (gas: 705 (0.381%))
testUnPauseRevertsIfNotPauser() (gas: 93 (0.389%))
testSqrt(uint128) (gas: 3 (0.390%))
testStethethCrvOracleReturnsTheCorrectPrice() (gas: 3084 (0.394%))
testStethethCrvOracleReturnsTheCorrectPrice() (gas: 3084 (0.394%))
testOverLiquidationAndLiquidateInsolventVault() (gas: 5334 (0.402%))
testLiquidateCompleteVaultLessThan18Decimals() (gas: 5241 (0.406%))
testExecuteProposalCallsCorrectContracts() (gas: 759 (0.407%))
testApprove(address) (gas: 162 (0.415%))
testRevertsIfCalledByNonVault() (gas: 60 (0.419%))
testLiquidateVaultWhenPriceIsStaleLessThan18Decimals() (gas: 5928 (0.425%))
testAllowance(address) (gas: 156 (0.426%))
testSetPauserRevertsIfNotOwner() (gas: 72 (0.435%))
testCubicRootHardcoded() (gas: 3 (0.439%))
testCurrentValueCallsVirtualPrice() (gas: 132 (0.441%))
testMint(address,uint96) (gas: 276 (0.443%))
testSqrtHardcoded() (gas: 3 (0.453%))
testRevertsWhenNoActions() (gas: 99 (0.470%))
testSusdOracle() (gas: 438 (0.473%))
testChangeCvxRewardFee(uint256) (gas: 105 (0.476%))
testChangeCrvRewardFee(uint256) (gas: 105 (0.476%))
testRevertsIfCalledByNonVault(uint56) (gas: 60 (0.485%))
testCurrentValueCallsRemoveLiquidity() (gas: 150 (0.493%))
testOverLiquidationAndLiquidateInsolventVaultLessThan18Decimals() (gas: 8286 (0.499%))
testIsStale() (gas: 84 (0.501%))
testTransfer(address) (gas: 264 (0.509%))
testBalanceOfUserWithZeroTokens(address) (gas: 66 (0.513%))
testRevertsIfProposalIsAboveThreshold() (gas: 189 (0.533%))
testCubicRoot(uint80) (gas: 6 (0.540%))
testChainlinkOracleRelayWithPriceStale(int256) (gas: 114 (0.568%))
testIsNotStale() (gas: 84 (0.576%))
testRevertIfNotOwner(address,uint256) (gas: 96 (0.576%))
testCallsPeekValueOnUsdtFeed() (gas: 135 (0.582%))
testCallsPeekValueOnEthFeed() (gas: 135 (0.582%))
testCallsPeekValueOnWbtcFeed() (gas: 135 (0.583%))
testFrax3CrvOracleReturnsTheCorrectPrice() (gas: 4491 (0.584%))
testEmitEvent(address) (gas: 222 (0.591%))
testGetCurrentVotesWhenZero(address) (gas: 78 (0.596%))
testOwnerReturnsThis() (gas: 48 (0.622%))
testRevertIfReceiverIsZeroAddress(uint96) (gas: 84 (0.627%))
testClaimableWithLessAMPHThanNeeded(uint256,uint256) (gas: 249 (0.631%))
testChainlinkOracleRelay(int256) (gas: 114 (0.640%))
testFraxCrvOracleReturnsTheCorrectPrice() (gas: 2247 (0.644%))
testZeroAllowance(address) (gas: 66 (0.648%))
testTransferFrom(address) (gas: 423 (0.651%))
testSetVaultController(address) (gas: 234 (0.651%))
testSusdFraxCrvOracleReturnsTheCorrectPrice() (gas: 4191 (0.660%))
testConstructorParams() (gas: 156 (0.662%))
testChangeCvxRewardFeeRevertOnlyOwner(address) (gas: 90 (0.665%))
testChangeCrvRewardFeeRevertOnlyOwner(address) (gas: 90 (0.667%))
testUnPause() (gas: 102 (0.671%))
testSetPauser() (gas: 141 (0.673%))
test3CrvOracleReturnsTheCorrectPrice() (gas: 4092 (0.683%))
testSusdDaiUsdtUsdcOracleReturnsTheCorrectPrice() (gas: 7647 (0.691%))
testChainlinkOracleRelayRevertWithPriceLessThanZero(int256) (gas: 90 (0.697%))
testE2EPeekValueWBTCUSDC() (gas: 183 (0.700%))
testGetValueAtRevertWithTokenNotEnabled(address,int256) (gas: 78 (0.700%))
testRevertIfAmountExceedsSpenderAllowance(address) (gas: 114 (0.703%))
testClaimableWithAmountsInZero(uint256) (gas: 144 (0.726%))
testEmitEvent(address,address) (gas: 288 (0.733%))
testAMPHClaimer() (gas: 2208 (0.739%))
testRecoverDustRevertOnlyOwner(address) (gas: 102 (0.746%))
testEmitEvent(address,address) (gas: 516 (0.749%))
testChangeVaultControllerRevertOnlyOwner(address) (gas: 102 (0.753%))
testConstructorParams() (gas: 144 (0.776%))
testRevertIfReceiverIsZeroAddress(uint96) (gas: 90 (0.777%))
testCurrentValue(uint32,uint32) (gas: 357 (0.779%))
testPeekValue(uint32,uint32) (gas: 369 (0.784%))
testRevertIfBlockNumberIsInvalid(address) (gas: 69 (0.785%))
testSetCurveWithVaultControllerInZero(address,address) (gas: 312 (0.790%))
testForceSetCurveWithVaultControllerInZero(address,address) (gas: 300 (0.803%))
testClaimableWithAMPHBalanceInZero(uint256,uint256) (gas: 168 (0.805%))
testRevertIfAmountHigherThanBalance(address) (gas: 132 (0.827%))
testSetCurveWithVaultControllerNotInZero(address,address) (gas: 573 (0.845%))
testCurrentValue(uint256,uint256,uint256) (gas: 288 (0.851%))
testUnderlying() (gas: 84 (0.861%))
testUnderlying() (gas: 84 (0.861%))
testChainlinkTokenOracleRelayIsStaleIfBothAreStale() (gas: 132 (0.884%))
testCurrentValue(uint256,uint256,uint256) (gas: 255 (0.920%))
testChainlinkTokenOracleRelayIsStaleIfFeedIsStale() (gas: 138 (0.923%))
testClaimAMPHWithInvalidVault(address) (gas: 303 (0.923%))
testGetValueAt(address,address,int256) (gas: 390 (0.923%))
testGetValueAtRevertWithZeroResult(address,address,int256) (gas: 390 (0.924%))
testPeekValueDoesNotUpdateVirtualPrice(uint256,uint256,uint256) (gas: 314 (0.930%))
testChainlinkTokenOracleRelayIsStaleIfBaseIsStale() (gas: 144 (0.940%))
testCTokenOracleCurrentValue(uint256,uint256) (gas: 252 (1.000%))
testChainlinkTokenOracleRelay(uint256,uint256) (gas: 171 (1.018%))
testChainlinkTokenOracleRelayIsNotStaleIfNonAreStale() (gas: 156 (1.019%))
testClaimAMPHEmitEvent(uint256,uint256) (gas: 558 (1.030%))
testGetPriorVotesWhenThereAreNoPriorVototes(address) (gas: 87 (1.044%))
testRevertsWhenVotesBelowThreshold() (gas: 339 (1.068%))
testCTokenOracleConstructorWhenUnderlyingIsUSDC() (gas: 222 (1.074%))
testAMPHClaimerExactMatch() (gas: 7299 (1.086%))
testTotalToFraction() (gas: 126 (1.103%))
testChangeVaultController(address) (gas: 261 (1.148%))
testCTokenOracleChangeAnchoredView(address) (gas: 231 (1.154%))
testCliffsAreConsumed() (gas: 21663 (1.159%))
testClaimAMPH(uint256,uint256) (gas: 723 (1.159%))
testSetVaultControllerRevertOnlyOwner(address) (gas: 150 (1.214%))
testCTokenOracleChangeAnchoredViewRevertWhenCalledByNonOwner(address) (gas: 150 (1.218%))
testCurrentValueRevertWithInvalidOracleValue() (gas: 174 (1.235%))
testCurrentValue(uint32,uint32,uint32) (gas: 318 (1.237%))
testRevertsWhenWrongArity() (gas: 369 (1.257%))
testForceSetCurveRevertOnlyOwner(address) (gas: 162 (1.301%))
testSetCurveRevertOnlyOwner(address) (gas: 162 (1.301%))
testClaimableWithMoreAMPHThanNeeded() (gas: 1491 (1.328%))
testCurrentValueRevertWithInvalidAnchorValue() (gas: 279 (1.407%))
testRecoverDust(address,uint256) (gas: 303 (1.449%))
testCurrentValueRevertWithAnchorTooHighAndStalePrice(uint256) (gas: 561 (1.725%))
testCurrentValueRevertWithAnchorTooHigh(uint256) (gas: 561 (1.726%))
testCurrentValueRevertWithAnchorTooLow(uint256) (gas: 561 (1.726%))
testCurrentValueRevertWithAnchorTooLowAndStalePrice(uint256) (gas: 561 (1.726%))
testRevertsWhenTooManyActions() (gas: 1122 (1.806%))
testThreeLinesViaCurveMaster() (gas: 468 (1.922%))
testwUSDAUniV3() (gas: -313867 (-3.350%))
testUniV3Pool() (gas: -315103 (-3.447%))
testCurveLpLiquidation() (gas: -307387 (-4.524%))
testUniPool() (gas: -315364 (-4.719%))
testMultiAssetLoan() (gas: -296719 (-4.980%))
testWBtcLoan() (gas: -308050 (-6.591%))
testDepositAndRepayWhenUSDAIsPaused() (gas: -311521 (-7.350%))
testBorrowSUSD() (gas: -314446 (-7.833%))
testNotSafeOracleIsRektByManipulation() (gas: -119141 (-7.926%))
testWithdrawSUSD() (gas: -314857 (-7.934%))
testDepositAndInterestWithStartingBalance() (gas: -315070 (-7.995%))
testWithdrawTokensWhichWouldLiquidateYourVault() (gas: -314287 (-8.027%))
testMigrateVaultController() (gas: -1390789 (-8.403%))
testNoReserve() (gas: -630725 (-8.554%))
testMigrateFromOldVaultController() (gas: -447539 (-9.016%))
testClaimRewardsWhenTheVaultControllerIsChangedInTheClaimer() (gas: -1080514 (-9.271%))
testDepositATokenWhenItSurpassesTheCap() (gas: -316516 (-9.329%))
testOracleReturnsTheCorrectPrice() (gas: -71391 (-9.436%))
testWithdrawMoreTokensThanYouHave() (gas: -316426 (-9.854%))
testDepositTokenThatIsNotWhitelisted() (gas: -316582 (-10.273%))
testWithdrawATokenThatYouDontHave() (gas: -316603 (-10.275%))
testNotSafeOracleIsRektByManipulation() (gas: -426102 (-10.657%))
invariant_callSummary() (gas: 0 (NaN%))
invariant_theSUSDInContractShouldBeEqualToTheDepositedMinusTheWithdrawn() (gas: 0 (NaN%))
invariant_theSumOfDepositedMinusWithdrawnShouldBeEqualToTotalSupply() (gas: 0 (NaN%))
invariant_GettersDoNotRevert() (gas: 0 (NaN%))
invariant_SumOfCollateralsShouldBeEqualToTokensRegistered() (gas: 0 (NaN%))
invariant_SumOfTotalBorrowedAndBorrowedFeeShouldBeEqualToTotalLiability() (gas: 0 (NaN%))
invariant_TotalLiabilityShouldBeLessThanTotalDeposited() (gas: 0 (NaN%))
invariant_callSummary() (gas: 0 (NaN%))
testCalculateInterestZero() (gas: 0 (0.000%))
testCheckVaultSolvent() (gas: 90 (0.090%))
testRevertIfTokenAlreadyRegistered(address,uint64,uint256) (gas: 207 (0.092%))
testRevertIfVaultIsSolvent() (gas: 96 (0.094%))
testRevertIfVaultIsSolvent() (gas: 99 (0.096%))
testEmitEvent(uint256) (gas: 57 (0.101%))
testBorrowUSDACallsCurrentValue() (gas: 261 (0.109%))
testEmitEvent(address) (gas: 264 (0.116%))
testRevertIfPaused(uint96) (gas: 33 (0.117%))
testEmitEvent(uint256) (gas: 69 (0.117%))
testCallVaultControllerTransfer(address) (gas: 267 (0.119%))
testBorrowUSDATreasuryReceivesFee() (gas: 291 (0.119%))
testWithdrawRevertsIfAmountIsGreaterThanBalance() (gas: 33 (0.119%))
testCheckVaultInsolvent() (gas: 312 (0.123%))
testVaultBorrowingPower() (gas: 126 (0.124%))
testRevertIfVaultInsolvent(address) (gas: 201 (0.126%))
testVaultBorrowingPowerWbtc() (gas: 132 (0.127%))
testCheckVaultCallsCurrentValue() (gas: 135 (0.128%))
testWithdrawToRevertsIfAmountIsZero() (gas: 30 (0.133%))
testBorrowUSDATo() (gas: 330 (0.133%))
testBorrowUSDA() (gas: 336 (0.136%))
testRevertIfVaultInsolvent() (gas: 225 (0.142%))
testCallModifyLiability(address) (gas: 321 (0.142%))
testVaultBorrowingPowerWhenOracleReturnsZero() (gas: 147 (0.147%))
testWithdrawRevertsIfAmountIsZero() (gas: 30 (0.147%))
testRegisterCurveLPToken(address,uint64,uint256,uint8) (gas: 432 (0.149%))
testWithdrawToRevertsIfAmountIsGreaterThanBalance() (gas: 45 (0.150%))
testRevertIfVaultIsSolvent(uint256) (gas: 156 (0.151%))
testWithdrawToSubstractsFromUserBalance(uint256) (gas: 93 (0.156%))
testWithdrawSubstractsFromUserBalance(uint256) (gas: 93 (0.162%))
testBorrowUSDAWithFeeInZero() (gas: 372 (0.164%))
testRegisterERC20(address,address,uint8) (gas: 393 (0.165%))
testRevertIfVaultIsSolvent(uint256) (gas: 180 (0.170%))
testCap(uint256) (gas: 162 (0.175%))
testWithdrawToSubstractsFromTotalSupply(uint256) (gas: 105 (0.179%))
testWithdrawToSubstractsFromReserveAmount(uint256) (gas: 105 (0.179%))
testSubstractFromReserveAmount(uint56) (gas: 135 (0.180%))
testRevertIfWbtcVaultIsSolvent(uint256) (gas: 486 (0.184%))
testWithdrawRevertsIfPaused() (gas: 51 (0.185%))
testWithdrawSubstractsFromTotalSupply(uint256) (gas: 105 (0.186%))
testWithdrawSubstractsFromReserveAmount(uint256) (gas: 105 (0.186%))
testRevertIfReserveIsEmpty() (gas: 93 (0.187%))
testWithdrawCallsTransferOnToken(uint256) (gas: 108 (0.187%))
testVaultBorrowingPowerWhenLTVIsZero() (gas: 624 (0.188%))
testWithdrawAllToRevertsIfPaused() (gas: 66 (0.189%))
testCallModifyLiability() (gas: 123 (0.194%))
testCallVaultControllerBurn() (gas: 123 (0.194%))
testWithdrawAllToSubstractsFromUserBalance() (gas: 96 (0.200%))
testWithdrawToCallsTransferOnToken(uint256) (gas: 120 (0.200%))
testValidVault() (gas: 69 (0.201%))
testIncrease(uint56) (gas: 81 (0.203%))
testVaultControllerDonateMoreThanMaxSupplyCapsMaxSupply() (gas: 156 (0.203%))
testWithdrawAllToSubstractsFromReserveAmount() (gas: 96 (0.203%))
testWithdrawAllToSubstractsFromTotalSupply() (gas: 96 (0.203%))
testVaultBorrowingPowerMultipleCollateral() (gas: 810 (0.204%))
testWithdrawCallsPayInterest() (gas: 96 (0.204%))
testRevertNotValidToken() (gas: 81 (0.205%))
testTokensToLiquidate() (gas: 255 (0.207%))
testWithdrawToRevertsIfPaused() (gas: 63 (0.212%))
testWithdrawAllToCallsPayInterest() (gas: 105 (0.216%))
testWithdrawToCallsPayInterest() (gas: 108 (0.219%))
testGetCollateralsInfoWith2Items() (gas: 216 (0.220%))
testWithdrawRevertsIfPaused() (gas: 72 (0.220%))
testRevertsIfCalledByNonVault(uint256) (gas: 24 (0.221%))
testRevertIfReserveIsEmpty() (gas: 105 (0.222%))
testWithdrawSubstractsFromUserBalance() (gas: 102 (0.223%))
testWithdrawAllToReturnsCorrectAmount() (gas: 102 (0.226%))
testWithdrawSubstractsFromReserveAmount() (gas: 102 (0.227%))
testWithdrawSubstractsFromTotalSupply() (gas: 102 (0.227%))
testRepayUSDA(uint56) (gas: 159 (0.228%))
testRevertCapReached(uint256) (gas: 162 (0.228%))
testGetCollateralsInfoWith5Items() (gas: 297 (0.230%))
testOwnerVaultIds() (gas: 36 (0.232%))
testOwnerVaultIds() (gas: 36 (0.232%))
testWithdrawCallsPayInterest() (gas: 111 (0.240%))
testWithdrawAllToCallsTransferOnToken() (gas: 123 (0.241%))
testOracleType() (gas: 24 (0.245%))
testOracleType() (gas: 24 (0.245%))
testAmountToSolvency() (gas: 294 (0.247%))
testWithdrawAllReturnsCorrectAmount() (gas: 108 (0.252%))
testMintAddsToTotalSupply(uint256) (gas: 180 (0.259%))
testEmitEvent(uint256) (gas: 189 (0.260%))
testMintAddsToTotalSupply(uint256) (gas: 168 (0.261%))
testEmitEvent(uint256) (gas: 177 (0.263%))
testWithdrawCallsTransferOnToken() (gas: 129 (0.265%))
testOwnerVaultIds() (gas: 42 (0.271%))
testOwnerVaultIds() (gas: 42 (0.271%))
testOwnerVaultIds() (gas: 42 (0.271%))
testOwnerVaultIds() (gas: 42 (0.271%))
testOwnerVaultIds() (gas: 42 (0.272%))
testOwnerVaultIds() (gas: 42 (0.272%))
testOwnerVaultIds() (gas: 42 (0.272%))
testRevertIfRegisterFromNonOwner() (gas: 42 (0.274%))
testRevertsIfPaused() (gas: 69 (0.279%))
testCallModifyLiability(uint56) (gas: 192 (0.279%))
testCallVaultControllerBurn(uint56) (gas: 192 (0.279%))
testVaultControllerDonate(uint56) (gas: 96 (0.282%))
testMintAddsToUserBalance(uint256) (gas: 198 (0.284%))
testEmitEvent() (gas: 1182 (0.286%))
testWithdrawAllToWhenAmountIsMoreThanReserve() (gas: 192 (0.288%))
testMintAddsToUserBalance(uint256) (gas: 186 (0.288%))
testDecrease(uint56) (gas: 117 (0.289%))
testRevertIfNotValidVault(address) (gas: 54 (0.290%))
testLiquidateWbtc() (gas: 1005 (0.290%))
testWithdrawAllWhenAmountIsMoreThanReserve() (gas: 198 (0.307%))
testLiquidatePartialWbtc() (gas: 1278 (0.310%))
testRevertIfVaultDoesNotExist(uint96) (gas: 36 (0.318%))
testSimulateLiquidateVault() (gas: 1623 (0.320%))
testRevertIfTooMuchRepay() (gas: 42 (0.321%))
testWrapperToUnderlying(uint256) (gas: 54 (0.323%))
testUnderlyingToWrapper(uint256) (gas: 54 (0.324%))
testCallExternalCalls() (gas: 1407 (0.335%))
testTotalUnderlying() (gas: 54 (0.340%))
testRevertsIfCalledByNonVault(bool,uint256) (gas: 30 (0.346%))
testOwnerVaultIds() (gas: 54 (0.349%))
testOwnerVaultIds() (gas: 54 (0.349%))
testOwnerVaultIds() (gas: 54 (0.349%))
testOwnerVaultIds() (gas: 54 (0.350%))
testMintCallsTransferFromOnUser(uint256,uint128) (gas: 258 (0.363%))
testPauseVaultController() (gas: 93 (0.364%))
testEmitEvent(address) (gas: 75 (0.366%))
testRevertIfProvidedTokenIsNotCurveLP() (gas: 144 (0.367%))
testLiquidateWhenLiquidationFeeIsZero() (gas: 1899 (0.373%))
testLiquidateWithCurveLpAsCollateral() (gas: 1902 (0.373%))
testMintCallsTransferFromOnUser(uint256,uint128) (gas: 246 (0.374%))
testRevertIfPaused() (gas: 99 (0.382%))
testTokenBalance(uint256) (gas: 192 (0.382%))
testUpdateRegisteredSingleToCurveLPStakedOnConvex(address,uint256,uint256,uint256) (gas: 375 (0.385%))
testRevertIfIncompatibleLTV(address,uint64,uint256) (gas: 63 (0.385%))
testOwnerVaultIds() (gas: 60 (0.388%))
testVaultSummaries() (gas: 486 (0.399%))
testRevertIfRegisterFromNonOwner(address) (gas: 54 (0.402%))
testRevertIfChangeFromNonOwner(address) (gas: 54 (0.403%))
testModifyLiabilitIncrease(uint56) (gas: 72 (0.406%))
testRevertsIfCalledByNonVault(address,uint256) (gas: 36 (0.414%))
testRevertsIfCalledByNonVault() (gas: 60 (0.418%))
testEmitEvent(uint256,uint128) (gas: 288 (0.420%))
testEmitEvent(uint256,uint128) (gas: 300 (0.423%))
testOwnerVaultIds() (gas: 66 (0.425%))
testRevertIfPaused(uint96,address,uint256) (gas: 123 (0.426%))
testRevertIfVaultDoesNotExist(uint96) (gas: 48 (0.427%))
testRevertIfVaultNotFound(uint96) (gas: 48 (0.427%))
testDepositERC20(uint256) (gas: 213 (0.428%))
testRevertIfPaused(uint96,uint192,address) (gas: 123 (0.430%))
testRevertIfPaused(uint96,uint192) (gas: 123 (0.433%))
testUpdateRegisteredERC20(address,uint256,uint256) (gas: 189 (0.439%))
testDepositAddsToTotalSupply(uint256,uint128) (gas: 294 (0.446%))
testDepositAddsToTotalSupply(uint256,uint128) (gas: 306 (0.449%))
testModifyLiabilitDecrease() (gas: 54 (0.450%))
testDepositCallsTransferFromOnUser(uint256,uint128) (gas: 300 (0.454%))
testDepositCallsTransferFromOnUser(uint256,uint128) (gas: 312 (0.457%))
testControllerTransfer(address) (gas: 102 (0.465%))
testModifyTotalDepositedIsCalled(uint256) (gas: 234 (0.467%))
testDepositAddsToUserBalance(uint256,uint128) (gas: 312 (0.472%))
testDepositAddsToUserBalance(uint256,uint128) (gas: 324 (0.473%))
testBalanceOfUnderlying(address,uint256) (gas: 342 (0.484%))
testRevertIfTokenNotRegistered(address) (gas: 183 (0.487%))
testEmitEvent(uint256) (gas: 189 (0.491%))
testRevertIfChangeFromNonOwner(uint192) (gas: 66 (0.491%))
testRevertsIfCalledByNonVault(uint56) (gas: 60 (0.492%))
testRevertIfChangeFromNonOwner(uint192) (gas: 66 (0.493%))
testRevertIfChangeFromNonOwner(uint192) (gas: 66 (0.493%))
testVaultLiability(uint56) (gas: 93 (0.493%))
testRevertIfUpdateFromNonOwner(address,address,uint64,uint256,uint256) (gas: 69 (0.498%))
testBurnSubtractsFromTotalSupply(uint256) (gas: 180 (0.505%))
testRevertIfPaused(uint96,uint192) (gas: 147 (0.517%))
testCallExternalCalls() (gas: 549 (0.521%))
testRevertIfTokenNotRegistered(address,address,uint64,uint256) (gas: 87 (0.532%))
testEmitEvent(uint256) (gas: 177 (0.533%))
testRevertIfNotMinter(uint192,address) (gas: 138 (0.539%))
testBurnSubtractsFromUserBalance(uint256) (gas: 198 (0.553%))
testBurnSubtractsFromTotalSupply(uint256) (gas: 168 (0.553%))
testRegisterCurveMaster() (gas: 135 (0.571%))
testVaultSummariesAll() (gas: 1227 (0.580%))
testVaultSummariesBigEnd() (gas: 1245 (0.588%))
testRevertIfNotMinter(uint192) (gas: 150 (0.590%))
testWithdrawERC20() (gas: 186 (0.602%))
testBurnSubtractsFromUserBalance(uint256) (gas: 186 (0.609%))
testRevertIfUpdatingPoolIdAndLpTokenDoesNotMatch(address,uint256,uint256,uint256) (gas: 156 (0.611%))
testRegisterUSDA(address) (gas: 123 (0.611%))
testRevertIfFeeIsTooHigh(uint192) (gas: 84 (0.612%))
testRevertIfFeeIsTooHigh(uint192) (gas: 84 (0.614%))
testExpectTransferCRV() (gas: 270 (0.615%))
testModifyTotalDepositedIsCalled() (gas: 186 (0.618%))
testWithdrawERC20CallsCheckVault() (gas: 186 (0.626%))
testRevertIfLiquidateZeroAmount(uint96,address) (gas: 87 (0.647%))
testRevertIfLiquidateTokenNotRegistered(uint96,address,uint256) (gas: 120 (0.655%))
testRevertIfAmountZero() (gas: 120 (0.661%))
testEmitEvent() (gas: 195 (0.678%))
testBurnCallsTransferToUser(uint256,uint128) (gas: 264 (0.681%))
testRevertIfLiquidateTokenNotRegistered(uint96,address,uint256) (gas: 96 (0.694%))
testCanStakeReturnFalseWithZeroBalance(address) (gas: 120 (0.695%))
testWithdrawAllToCallsTransferFromUser() (gas: 222 (0.698%))
testChangeProtocolFee(uint192) (gas: 153 (0.699%))
testRevertIfLiquidateZeroAmount(uint96,address) (gas: 63 (0.701%))
testWithdrawAllCallsTransferFromUser() (gas: 216 (0.734%))
testChangeClaimerContract(address) (gas: 171 (0.739%))
testEmitEvent(uint256,uint128) (gas: 306 (0.739%))
testEmitEvent(uint256,uint128) (gas: 294 (0.753%))
testBurnCallsTransferToUser(uint256,uint128) (gas: 252 (0.753%))
testEmitEvent() (gas: 195 (0.759%))
testToBase18() (gas: 81 (0.765%))
testCVX() (gas: 60 (0.775%))
testCRV() (gas: 60 (0.779%))
testRevertIfVaultDoesNotExist(uint96,uint256) (gas: 108 (0.781%))
testRevertIfNotVaultOwner(address) (gas: 138 (0.785%))
testUnderlying() (gas: 60 (0.787%))
testWithdrawToSubstractsFromTotalSupply(uint256,uint128) (gas: 303 (0.787%))
testRevertIfVaultDoesNotExist(uint96,uint256) (gas: 144 (0.790%))
testWithdrawSubstractsFromTotalSupply(uint256,uint128) (gas: 291 (0.804%))
testEmitEvent() (gas: 189 (0.806%))
testChangeLiquidationFee(uint192) (gas: 189 (0.809%))
testEmitEvent() (gas: 189 (0.812%))
testWithdrawToSubstractsFromUserBalance(uint256,uint128) (gas: 315 (0.814%))
testRevertIfFeeIsTooHigh(uint192) (gas: 120 (0.825%))
testPeekValue(uint256,uint256) (gas: 135 (0.828%))
testWithdrawSubstractsFromUserBalance(uint256,uint128) (gas: 303 (0.832%))
testWithdrawToCallsTransferFromUser(uint256,uint128) (gas: 324 (0.840%))
testWithdrawCallsTransferFromUser(uint256,uint128) (gas: 312 (0.861%))
testExpectCallDepositOnConvex(uint256) (gas: 654 (0.865%))
testBurnSubtractsFromTotalSupply() (gas: 186 (0.887%))
testClaimWhenNoAMPHToClaim() (gas: 498 (0.891%))
testBurnSubtractsFromTotalSupply() (gas: 144 (0.899%))
testClaimWhenTheRewardsAreZero() (gas: 297 (0.900%))
testRevertIfOverWithdrawal(uint256) (gas: 246 (0.901%))
testClaimExtraRewards() (gas: 525 (0.903%))
testRevertControllerWithdrawAndUnwrap(address,uint256) (gas: 120 (0.914%))
testCanStakeReturnFalseWhenTokenAlreadyStaked(address) (gas: 807 (0.917%))
testChangeInitialBorrowingFee(uint192) (gas: 225 (0.925%))
testCanStakeReturnTrue(address) (gas: 522 (0.928%))
testBurnCallsTransferToUser(uint128) (gas: 270 (0.934%))
testCanStakeReturnFalseWithZeroPoolId(address) (gas: 516 (0.959%))
testBurnSubtractsFromUserBalance() (gas: 204 (0.962%))
testBurnSubtractsFromUserBalance() (gas: 159 (0.981%))
testControllerWithdrawAndUnwrap(address,uint256) (gas: 141 (1.029%))
testEnabledTokens() (gas: 402 (1.058%))
testWithdrawAllToSubstractsFromTotalSupply(uint128) (gas: 303 (1.064%))
testRevertIfProvidedTokenIsNotCurveLP() (gas: 162 (1.068%))
testRevertIfNotVaultOwner(address,uint256) (gas: 183 (1.098%))
testRevertIfNotVaultOwner(address,uint256) (gas: 183 (1.099%))
testClaimMultipleTokens() (gas: 726 (1.102%))
testBurnCallsTransferToUser(uint128) (gas: 264 (1.117%))
testCallsPeekValueOnStEthOracle() (gas: 180 (1.118%))
testWithdrawAllToSubstractsFromUserBalance(uint128) (gas: 321 (1.119%))
testCallsStEthPerTokenOnWsteth() (gas: 180 (1.120%))
testWithdrawAllSubstractsFromTotalSupply(uint128) (gas: 297 (1.133%))
testRevertIfStakeOnConvexFails(uint256) (gas: 615 (1.167%))
testWithdrawAllSubstractsFromUserBalance(uint128) (gas: 315 (1.192%))
testRevertIfIncompatibleLTV(address,address,uint64,uint256) (gas: 327 (1.219%))
testRevertIfRegisterCurveLpWithMoreThan18Decimals(address,uint64,uint256,uint8) (gas: 372 (1.267%))
testDepositTokenAlreadyStaked(uint256) (gas: 1368 (1.455%))
testRevertIfStakeOnConvexOnAlreadyStakedTokenFails(uint256) (gas: 1308 (1.456%))
testRevertIfStakeFails(address) (gas: 1257 (1.512%))
testClaimableRewards() (gas: 768 (1.522%))
testRevertIfTokenAddressDoesNotMatchLPTokenAddress(address,address,uint64,uint256) (gas: 378 (1.523%))
testStakeCurveLP(address) (gas: 1329 (1.527%))
testRevertIfTokenIsStaked(address) (gas: 1338 (1.540%))
testRevertIfRegisterERC20WithMoreThan18Decimals(address,address,uint8) (gas: 312 (1.566%))
testRevertIfTokenNotRegistered(address,uint256) (gas: 276 (1.587%))
testRevertIfTokenNotRegistered(address,uint256) (gas: 276 (1.587%))
testRevertIfUnstakeOnConvexFails(uint256) (gas: 1095 (1.636%))
testExpectCallWithdrawOnConvex(uint256) (gas: 1140 (1.651%))
testRevertIfTokenNotRegistered(address) (gas: 219 (1.662%))
testClaimableWhenAmphClaimerIsZeroAddress() (gas: 666 (1.667%))
testRevertIfBalanceZero(address) (gas: 351 (1.681%))
testRevertIfRegisterFromNonOwner(address,address,uint256,uint256,uint256,uint8) (gas: 303 (1.734%))
testGetLiquidationFee(uint192) (gas: 363 (1.748%))
testRevertIfPoolIdZero(address) (gas: 351 (1.878%))
testGetBorrowingFee(uint192) (gas: 354 (2.101%))
testMigrateCollaterallsFrom() (gas: -469140 (-8.545%))
testMigrateFromPreviousVaultController() (gas: -469176 (-8.547%))
testDeployedCorrectly() (gas: -469080 (-9.285%))
testRevertIfWrongCollateral() (gas: -469383 (-9.288%))
testGetVault() (gas: -316804 (-10.318%))
testUnPauseVaultController() (gas: -316639 (-10.340%))
testMintVault() (gas: -316717 (-10.405%))
testDeployVault(uint96,address) (gas: -316672 (-10.642%))
testDeploy(address,address,address,address,uint256,uint256) (gas: -136270 (-11.240%))
testCTokenOracleConstructorWhenUnderlyingIsETH() (gas: -71899 (-13.337%))
testUniswapV3OracleRelayCurrentValueMocked(uint8,uint8,bool,uint256) (gas: -197827 (-13.943%))
testUniswapV3OracleRelayCurrentValueMocked(uint8,uint8,bool) (gas: -195300 (-14.355%))
Overall gas change: -12369516 (-5.394%)
```
**These optimizations are only intended to show the improvement potential of the cases and to provide a starting point, as it can be widely discussed. In particular, as the tests are not intended to represent a common use of contracts, but as these are the only clearly objective metrics, they are used for comparison.**

# [G-03] Review of automated finding G-05 and G-09
The purpose of this section is not to present an optimization, but to discuss the ones present in automated finding, to warn the recipient.

Firstly, these are obviously unclear due to textual errors, but that's not the point.
Then, these two types of optimization have in common that they are not general truths. They absolutely must be tested, as they can lead to a reduction or an increase in gas in certain cases. Fortunately, the latter is not the case here. But the report seems to include a lot of changes that simply can't be compiled if applied, so it's not possible to be certain that these optimizations are valid.

Changes that do not allow compilation are listed below.

**Memory to calldata:**
- [VaultController.sol#L769](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/VaultController.sol#L769)
- [GovernorCharlie.sol#L121](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L121)
- [GovernorCharlie.sol#L122](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L122)
- [GovernorCharlie.sol#L123](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L123)
- [GovernorCharlie.sol#L124](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L124)
- [GovernorCharlie.sol#L160](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L160)
- [GovernorCharlie.sol#L161](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L161)
- [GovernorCharlie.sol#L162](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L162)
- [GovernorCharlie.sol#L163](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L163)
- [GovernorCharlie.sol#L164](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L164)
- [GovernorCharlie.sol#L291](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L291)
- [GovernorCharlie.sol#L293](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L293)
- [GovernorCharlie.sol#L401](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L401)
- [GovernorCharlie.sol#L402](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L402)
- [VaultController.sol#L164](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/VaultController.sol#L164)

**Memory to storage:**
- [VaultController.sol#L676](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/VaultController.sol#L676)


The reader must be cautious before applying modifications to these lines.

The optimisation that are valid as is, are listed below:


**Memory to calldata:**
- [GovernorCharlie.sol#L125](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L125)
- [GovernorCharlie.sol#L140](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L140)
 - [GovernorCharlie.sol#L141](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L141)
- [GovernorCharlie.sol#L142](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L142)
- [GovernorCharlie.sol#143](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L143)
 - [GovernorCharlie.sol#L144](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L144)
- [GovernorCharlie.sol#L331](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L331)
 - [GovernorCharlie.sol#L332](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/governance/GovernorCharlie.sol#L401)
 - [Vault.sol#L164](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/Vault.sol#L164)

**Memory to storage:**
- [VaultController.sol#L869](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/VaultController.sol#L869)
- [VaultController.sol#L897](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/VaultController.sol#L897)
- [VaultController.sol#L1016](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/core/VaultController.sol#L1016)
